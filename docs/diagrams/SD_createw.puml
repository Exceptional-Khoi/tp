@startuml
' Rectangles + minimal chrome
skinparam sequenceParticipantType rectangle
skinparam shadowing false
skinparam responseMessageBelowArrow true
hide footbox

actor    User
participant ":UI" as UI
participant ":FitChasers" as App
participant ":WorkoutManager" as WM
participant ":Tagger" as Tagger
participant ":FileHandler" as FH
participant ":Workout" as W

User -> UI : enterText()
UI -> App : readCommand()
App -> WM : addWorkout(command)
activate WM

alt activeWorkoutExists
  WM -> WM : setMessage("Active workout exists. Please end it.")
else noActiveWorkout
  alt strictFormatDetected
    WM -> WM : formatInputForWorkoutStrict(command)
    alt inputInvalid
      WM -> WM : setMessage(error)
    else inputValid
      WM -> WM : prepareConfirmation()
      alt confirmation==false
        WM -> WM : setMessage("Cancelled")
      else proceedStrict
        WM -> WM : checkDuplicateStart()
        alt duplicateFound
          WM -> WM : prepareConfirmation()
          alt confirmation==false
            WM -> WM : setMessage("Cancelled")
          else proceedAfterDuplicate
          end
        end
      end
    end
  else flexibleFormat
    WM -> WM : formatInputForWorkout(command)
    WM -> WM : prepareConfirmation()
    alt confirmation==false
      WM -> WM : setMessage("Cancelled")
    else proceedFlexible
      WM -> WM : checkPastFutureDate()
      WM -> WM : checkDuplicateStart()
    end
  end

  ' --- Persist + tagging on success paths ---
  WM -> FH : loadMonthList(targetMonth)
  WM -> WM : setWorkouts(list, targetMonth)
  WM -> W : new(name, startDateTime)
  WM -> Tagger : suggest(workout)
  WM -> W : setAutoTags(suggestedTags)
  WM -> FH : saveMonthList(currentMonth, workouts)
  WM -> WM : setMessage("Workout created")
end

WM --> App : message
deactivate WM

App --> UI : message
UI -> User : displayMessage()
@enduml
